import Pkg; Pkg.activate("..");
import FiniteDiff;
include("../src/problem_info.jl")

const OBJECT_SET = SArray{Tuple{3,2}}(reshape([0.752,-0.19,0.089, 0.752, 0.09, -0.089], (3,2)));
const OBJECT_POS = OBJECT_SET[:,1];

function my_fk(traj::AbstractVector)
    joint_start = @SVector [-0.7240388673767146, -0.34790398102066433, 2.8303899987665897, -2.54032606205873, 1.3329587647643253, 2.7596249683074614, 0.850582268802067]
    # joint_target = [0.04506347261090404, 1.029660363493563, -0.0563325987175789, -1.8024937659056217, 0.14645022654203643, 0.3406148976556631, -0.12291455548612884] #near reaching case
    joint_target = @SVector [-0.3902233335085379, 1.7501020413442578, 0.8403277122861033, -0.22924505085794067, 2.8506926562622024, -1.417026666483551, -0.35668663982214976] #far reaching case
    n_timesteps = 20;
    dt = 0.25;

    params = ComotoParameters(
        joint_start,
        joint_target,
        n_timesteps,
        dt,
        OBJECT_SET
    )
    kuka_joints = ["iiwa_link_1", "iiwa_link_2", "iiwa_link_3",
        "iiwa_link_4", "iiwa_link_5", "iiwa_link_6", "iiwa_link_7"]
    kuka_info = RobotInfo(
        kuka_joints,
        "kuka.urdf",
        "iiwa_link_ee",
        7
    )
    base_prob_info = get_probinfo(params, kuka_info, "human_trajs/669-means-fmt.csv", 
        "human_trajs/669-vars-fmt.csv")
    for i=1:length(traj)
        println(translation(base_prob_info.eef_fk(traj[i])))
    end
end

# pos = [0,0,0,0,0,0,0];
# julia 120
jl_120 = [[-0.7240388673767146, -0.34790398102066433, 2.8303899987665897, -2.54032606205873, 1.3329587647643253, 2.7596249683074614, 0.850582268802067], [-0.9455019473334328, -0.229992638929517, 2.716465226501978, -2.699985163836409, 1.6964056225706539, 2.3181992557149416, 1.1781168237799304], [-1.0757278303836721, -0.006297623162829363, 2.6899076598212597, -2.73143390000855, 1.9947121645499821, 1.8992531939421826, 1.4642566829861525], [-1.2679470790105043, 0.16036536333810109, 2.6042545386394145, -2.7385237020569018, 2.1422473517763647, 1.3559757883859973, 1.7177053773459665], [-1.3546958671415115, 0.3240824537642958, 2.6297145080487367, -2.609634214422668, 2.201966836183056, 0.9468886475102265, 1.8842531740845816], [-1.4157635388858159, 0.4138317142219982, 2.4860649849278897, -2.497251071148194, 2.199582137865948, 0.535285340984258, 1.9133896837187887], [-1.406491243114815, 0.5027237060453231, 2.4036690990139875, -2.3259260725082256, 2.1778847949344473, 0.24851561501421143, 1.8969446132010852], [-1.309551915326459, 0.6473592278656348, 2.2093194212883054, -2.1700400108900166, 2.18236017551145, -0.13527159438304004, 1.7595172108244062], [-1.172532472432215, 0.7918477969520583, 2.0971649422530474, -1.97203400430844, 2.1784589200473228, -0.40672921111889876, 1.611917042498136], [-1.054224340438774, 0.9608732614570656, 1.9513194092613557, -1.7969092885162838, 2.172779291605952, -0.7166157060232512, 1.4146848589518441], [-0.9339874662336589, 1.103933203359412, 1.890099904992732, -1.6031846297584342, 2.160591243961526, -0.931458154955622, 1.2254422667789586], [-0.8455943759024958, 1.2576904339868502, 1.7879722895633323, -1.4477002079884176, 2.1346740896939442, -1.091926568364341, 0.9915025834183372], [-0.792665394031954, 1.3657565815191346, 1.7359864086015135, -1.3060589291888633, 2.107167115971248, -1.1956091912992854, 0.7996432978879051], [-0.7268337688287219, 1.497299422393909, 1.654656118234954, -1.1369066238702144, 2.082036800214653, -1.3230421461422759, 0.57612144062065], [-0.684914939151367, 1.58322010935871, 1.6209579335360564, -0.9834227797604456, 2.056788164617999, -1.396088285528166, 0.39431786758368426], [-0.658128717920209, 1.6885625075723096, 1.5731267105496256, -0.8383844442652548, 2.0378886025757375, -1.3781133551601055, 0.2427244349326023], [-0.6257735881576988, 1.7524712864341152, 1.5520573718157415, -0.7162163749766193, 2.0263504437351734, -1.3480037717250337, 0.12474357626155876], [-0.5980752207334173, 1.793647330304518, 1.5392948381164788, -0.613300552712108, 2.018548677363859, -1.3123573205048011, 0.03756442095366376], [-0.5720390060954007, 1.8129295583000355, 1.532811143882758, -0.5372754353846042, 2.014933044073968, -1.2770460418307743, -0.02007967799341772], [-0.5428246318637706, 1.8349781592852756, 1.5210158444277484, -0.4919416338416153, 2.0124851024629047, -1.2429230568533218, -0.04868463335594064]];

# comoto 120
comoto_120 = [[-7.24038867e-01, -3.47903981e-01,  2.83039000e+00, -2.05948852e+00,
1.33295876e+00,  2.05948852e+00,  8.50582269e-01],
[-4.90663696e-01, -4.53288544e-01,  2.93215314e+00, -1.88773620e+00,
1.44203356e+00,  1.73397906e+00,  7.27539090e-01],
[-4.73094458e-01, -3.42867174e-01,  2.83671568e+00, -1.66832477e+00,
1.57764559e+00,  1.52803034e+00,  6.45303553e-01],
[-5.34697071e-01, -2.18009875e-01,  2.65906856e+00, -1.56144677e+00,
1.61360109e+00,  1.36099351e+00,  5.51407420e-01],
[-5.73069411e-01, -9.07140082e-02,  2.53100107e+00, -1.50381291e+00,
1.67422641e+00,  1.30090798e+00,  4.47273347e-01],
[-5.26701878e-01,  1.34531235e-02,  2.46524162e+00, -1.43738403e+00,
1.74285303e+00,  1.20221905e+00,  3.90151970e-01],
[-5.65106113e-01,  1.12695551e-01,  2.38474526e+00, -1.38845594e+00,
1.83808194e+00,  1.10945408e+00,  3.05004910e-01],
[-6.45369407e-01,  2.39353638e-01,  2.27626509e+00, -1.31004306e+00,
2.01143909e+00,  9.19919844e-01,  2.41464441e-01],
[-7.33056487e-01,  3.39733375e-01,  2.16327497e+00, -1.18045947e+00,
2.12768940e+00,  6.44308503e-01,  1.99530564e-01],
[-7.68907199e-01,  4.30082413e-01,  2.01358187e+00, -1.04295953e+00,
2.20757013e+00,  3.81395389e-01,  1.29571003e-01],
[-7.64152414e-01,  5.93398997e-01,  1.85499732e+00, -8.93211003e-01,
2.25108129e+00,  9.31289621e-02,  7.30811201e-02],
[-7.46583175e-01,  8.68356434e-01,  1.66244274e+00, -7.84067946e-01,
2.23748785e+00, -1.34864857e-01,  4.09523211e-02],
[-7.29013936e-01,  1.08378651e+00,  1.43782840e+00, -6.87739343e-01,
2.24290525e+00, -3.10364243e-01, -1.21856766e-03],
[-7.11444698e-01,  1.19706462e+00,  1.31308364e+00, -5.91410739e-01,
2.25209306e+00, -4.29845220e-01,  1.69576037e-02],
[-6.93875459e-01,  1.24842364e+00,  1.22277560e+00, -4.95082136e-01,
2.29991129e+00, -5.53944557e-01,  1.82877505e-02],
[-6.76306221e-01,  1.31827042e+00,  1.20054252e+00, -4.15412321e-01,
2.39067278e+00, -6.53803866e-01, -1.49218102e-02],
[-6.58736982e-01,  1.33839045e+00,  1.16152339e+00, -3.27413112e-01,
2.47654774e+00, -7.48788006e-01, -5.36681873e-02],
[-6.41167743e-01,  1.33587866e+00,  1.10900202e+00, -2.58017272e-01,
2.58678408e+00, -9.27455410e-01, -1.42002748e-01],
[-5.71166056e-01,  1.42387474e+00,  9.95638658e-01, -1.96414694e-01,
2.72361269e+00, -1.13489322e+00, -2.35874125e-01],
[-3.90223334e-01,  1.75010204e+00,  8.40327712e-01, -2.29245051e-01,
2.85069266e+00, -1.41702667e+00, -3.56686640e-01]];

my_fk(comoto_120)